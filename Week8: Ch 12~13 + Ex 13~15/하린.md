# 하린

# 12장. 타입스크립트 프로젝트 관리

## 엠비언트 타입 선언

`.d.ts` 확장자를 가진 파일에서는 타입 선언만 할 수 있으며 값을 표현할 수 없다. 값을 표현하는 일반적인 선언과 구별하기 위해 `.d.ts` 확장자를 가진 파일에서 하는 타입 선언을 **엠비언트 타입 선언** 이라고 부른다.
</br>
엠비언트 타입 선언으로 값을 정의할 수는 없지만 declare 라는 키워드를 사용하여 어딘가에 자바스크립트 값이 존재한다는 사실을 선언할 수 있다.

> declare 는 타입스크립트 컴파일러에 어떤 것의 존재 여부를 명시해주는 역할을 한다. 단순히 존재 여부만 알려주기 때문에 컴파일 대상이 아니다.

## 앰비언트 타입 선언 시 주의점

- 타입스크립트로 만드는 라이브러리에는 컴파일러가 .d.ts 파일을 자동으로 생성해주기 때문에 수동으로 작성할 필요가 없다.
- 명시적인 임포트나 익스포트가 없기 때문에 코드의 의존성 관계가 명확하지 않아 나중에 변경할 때 어려움을 겪을 수 있다.

## 앰비언트 타입 선언을 잘못 사용했을 때의 문제점

- .ts 파일 내부에 앰비언트 변수를 선언할 때 명시적인 임포트나 익스포트 없이 코드 전역에서 사용할 수 있기 때문에 </br> 타입의 의존성 관계가 보이지 않기 때문에 변경에 의한 영향 범위를 파악하기 어렵다.</br> .d.ts 파일 내에서 앰비언트 타입 선언을 하는 것은 일종의 약속이며 타입 선언 위치가 명확해야 가독성이 높아지고 유지보수고 편리하다.

## 앰비언트 타입 활용하기

### 타입을 정의하여 임포트 없이 전역으로 공유

d.ts 파일 내에서의 앰비언트 타입 선언은 전역 변수와 같은 역할을 하기 때문에 모든 코드 내에서 임포트하지 않고 사용할 수 있다.

```ts
// src/index.d.ts
type Optional<T extends object, K extends keyof T = keyof T> = Omit<T, K> &
  Partial<Pick<T, K>>;

// src/components.ts
type Props = { name: string; age: number; visible: boolean };
type OptionalProps = Optional<Props>; // {name?: string; age?: string; visible?: boolean}
```

### declare type 활용하기

많이 사용하는 커스텀 유틸리티 타입을 declare type 으로 선언하여 전역에서 사용할 수 있다.

```ts
declare type Nullable<T> = T | null;

const name: Nullable<string> = "woowa";
```

### declare module 활용하기

styled-components의 theme 인터페이스 타입을 확장하여 theme 타입이 자동으로 완성되도록 할 수 있다.

```ts
const fontSizes = {
    xl : "30px"
}

...

declare module "styled-components" {
    type Theme = typeof theme;

    export interface DefaultTheme extends Theme {}
}
```

로컬 이미지나 SVG같이 외부로 노출되어 있지 않은 파일을 모듈로 인식하여 사용할 수 있게끔 만들 수 있다.

```ts
declare module ".gif" {
  const src: string;

  export default src;
}
```

### declare namespace 활용하기

.env 파일을 사용할 때, process.env 로 설정값을 손쉽게 불러오고 환경변수의 자동 완성 기능을 쓸 수 있다.

```ts
declare namespace NodeJS {
  interface ProcessEnv {
    readonly API_URL: string;
    readonly API_INTERNAL_URL: string;
  }
}
```

이를 통해 process.env를 통해 접근하는 변수 또한 타입을 지정할 수 있기 때문에 as 단언을 사용하지 않아도 된다.

```ts
function log(str: string) {
  console.log(str);
}

API_URL = "localhost:3000";

log(process.env.API_URL);
```

### declare global 활용하기

전역 변수를 선언할 때 사용한다. 전역 변수인 Window 객체의 스코프에서 사용되는 모듈이나 변수를 추가할 수 있다.

```ts
declare global {
  interface Window {
    newProperty: string;
  }
}
```

대표적으로 네이티브 앱과의 통신을 위한 인터페이스를 Window 객체에 추가할 때 엠비언트 타입 선언을 활용할 수 있다.</br>
이를 통해 자동 완성이 가능하기 때문에 실수를 줄일 수 있다.

## 타입 커버리지 확인하기

```ts
npx type-coverage --detail
```

현재 프로젝트의 타입 커버리지와 any를 사용하고 있는 변수의 위치가 나타난다.

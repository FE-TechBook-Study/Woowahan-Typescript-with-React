# ìƒí˜„

## 8ì¥. JSXì—ì„œ TSXë¡œ

### ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ íƒ€ì…

**í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ íƒ€ì…**

````tsx
/**
 * Represents a JSX element.
 *
 * Where {@link ReactNode} represents everything that can be rendered, `ReactElement`
 * only represents JSX.
 *
 * @template P The type of the props object
 * @template T The type of the component or tag
 *
 * @example
 *
 * ```tsx
 * const element: ReactElement = <div />;
 * ```
 */
interface ReactElement<
  P = any,
  T extends string | JSXElementConstructor<any> =
    | string
    | JSXElementConstructor<any>
> {
  type: T;
  props: P;
  key: string | null;
}

interface Element extends React.ReactElement<any, any> {}

type ReactNode =
  | ReactElement
  | string
  | number
  | Iterable<ReactNode>
  | ReactPortal
  | boolean
  | null
  | undefined
  | DO_NOT_USE_OR_YOU_WILL_BE_FIRED_EXPERIMENTAL_REACT_NODES[keyof DO_NOT_USE_OR_YOU_WILL_BE_FIRED_EXPERIMENTAL_REACT_NODES];
````

í•¨ìˆ˜ì˜ ë°˜í™˜íƒ€ì…ì„ ìœ„ 3ê°€ì§€ë¡œ ë§ì´ ì‚¬ìš©ë˜ë©° ìƒê´€ê´¸ê³„ë¡œ í‘œí˜„í•˜ë©´ `JSX.Element > ReactElement > ReactNode`ìˆœìœ¼ë¡œ í‘œí˜„ ê°€ëŠ¥

ê¶Œì¥ë˜ëŠ” ì‚¬ìš© ë°©ë²•

- ReactNodeëŠ” ìµœìƒìœ„ë¡œ ëª¨ë“  ê²ƒì„ ë°›ì„ ìˆ˜ ìˆê¸°ì— ë‹¤ì–‘í•œ í˜•íƒœì— ì í•©
- JSX.ElementëŠ” ReactElementì— anyë¡œ íƒ€ì…ì„ ë§ì¶”ê¸°ì— ë„ëŸ´í•œ ReactElementì— ì í•©
- ReactElementì—ëŠ” ì§ì ‘ì ìœ¼ë¡œ propsë¥¼ ê¸°ì¬í•˜ì—¬ ì‚¬ìš©ì²˜ì—ì„œ ì¶”ë¡  ê°€ëŠ¥í•˜ê²Œ ì‚¬ìš©
  ```tsx
  interface IconProps {
  	size: number;
  }
  interface Props {
  	icon: React.ReactElement<IconProps>
  }
  const Item = ({icon}: Props) => {
  	// numberë¡œ ì¶”ë¡  ê°€ëŠ¥
  	const iconSize = icon.props.size;
  	return(...)
  }
  ```

**ê¸°ë³¸ HTML ìš”ì†Œ íƒ€ì… í™œìš©í•˜ê¸°**

htmlìš”ì†Œë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” íƒ€ì…ìœ¼ë¡œ ë‘ ê°œê°€ ì¡´ì¬

- `ComponentPropsWithoutRef`
- `DetailedHTMLProps`

ì‚¬ìš© ì°¨ì´:

- `DetailedHTMLProps`ì—ëŠ” refê°’ì´ í¬í•¨ì´ ë˜ì–´ ìˆê³ , `ComponentPropsWithoutRef`ì—ëŠ” ì—†ë‹¤. ë”°ë¼ì„œ, forwardRefë¥¼ ì‚¬ìš©í•  ê²½ìš° `ComponentPropsWithoutRef`ë¥¼ ì‚¬ìš©

### íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°

**ê³µë³€ì„±ê³¼ ë°˜ê³µë³€ì„±**

> ë‹¨, tsconfigì˜ strictFunctionTypes ì˜µì…˜ì´ true ì¼ë•Œì˜ ê¸°ì¤€ì´ë‹¤. ë§Œì¼ strict ëª¨ë“œê°€ ì•„ë‹ˆë¼ë©´ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” ì´ë³€ì„±ì„ ê°–ê³  ìˆë‹¤.

```tsx
// ì¶œì²˜: https://inpa.tistory.com/entry/TS-ğŸ“˜-íƒ€ì…ìŠ¤í¬ë¦½íŠ¸-ê³µë³€ì„±-ë°˜ê³µë³€ì„±-ğŸ’¡-í•µì‹¬-ì´í•´í•˜ê¸° [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬]
// ê³µë³€ì„± ì˜ˆì‹œ: A(ì¢ì€ íƒ€ì…)ê°€ B(ë„“ì€ íƒ€ì…)ì˜ ì„œë¸Œíƒ€ì…ì´ë©´, T<A>ëŠ” T<B>ì˜ ì„œë¸Œíƒ€ì…ì´ë‹¤
let stringArray: Array<string> = [];
let array: Array<string | number> = [];

array = stringArray; // OK - stringArrayëŠ” arrayë¥¼ í¬í•¨
stringArray = array; // Error

// --------------------------------------------------

let subObj: { a: string; b: number } = { a: "1", b: 1 };
let superObj: { a: string | number; b: number } = subObj; // superObjëŠ” subObj í¬í•¨

// subObj <: superObj
// ê°ê°ì˜ í”„ë¡œí¼í‹°ê°€ ëŒ€ì‘í•˜ëŠ” í”„ë¡œí¼í‹°ì™€ ê°™ê±°ë‚˜ ì„œë¸Œíƒ€ì…ì´ì–´ì•¼ í•œë‹¤.
```

```tsx
// ì¶œì²˜: https://inpa.tistory.com/entry/TS-ğŸ“˜-íƒ€ì…ìŠ¤í¬ë¦½íŠ¸-ê³µë³€ì„±-ë°˜ê³µë³€ì„±-ğŸ’¡-í•µì‹¬-ì´í•´í•˜ê¸° [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬]
// ë°˜ê³µë³€ì„±: A(ì¢ì€ íƒ€ì…)ê°€ B(ë„“ì€ íƒ€ì…)ì˜ ì„œë¸Œíƒ€ì…ì´ë©´, T<B>ëŠ” T<A>ì˜ ì„œë¸Œíƒ€ì…ì´ë‹¤.
type Logger<T> = (param: T) => void;

let logNumber: Logger<number> = (param) => {
  console.log(param); // number
};

let log: Logger<string | number> = (param) => {
  console.log(param); // string | number
};

logNumber = log; // OK
log = logNumber; // Error

// ê¸°ë³¸ì ìœ¼ë¡œ number <: string | number ì§€ë§Œ, í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜ ì œë„¤ë¦­ì—ì„œëŠ” ê±°ê¾¸ë¡œ
// Logger<string | number> <: Logger<number>
```

## TypeScript Exercise

```tsx
// 9ë²ˆ
interface User {
  type: "user";
  name: string;
  age: number;
  occupation: string;
}

interface Admin {
  type: "admin";
  name: string;
  age: number;
  role: string;
}

type Person = User | Admin;

const admins: Admin[] = [
  { type: "admin", name: "Jane Doe", age: 32, role: "Administrator" },
  { type: "admin", name: "Bruce Willis", age: 64, role: "World saver" },
];

const users: User[] = [
  {
    type: "user",
    name: "Max Mustermann",
    age: 25,
    occupation: "Chimney sweep",
  },
  { type: "user", name: "Kate MÃ¼ller", age: 23, occupation: "Astronaut" },
];

export type ApiResponse<T> =
  | { status: "success"; data: T }
  | { status: "error"; error: string };

export function requestAdmins(
  callback: (response: ApiResponse<Admin[]>) => void
) {
  callback({
    status: "success",
    data: admins,
  });
}

export function requestUsers(
  callback: (response: ApiResponse<User[]>) => void
) {
  callback({
    status: "success",
    data: users,
  });
}

export function requestCurrentServerTime(
  callback: (response: ApiResponse<number>) => void
) {
  callback({
    status: "success",
    data: Date.now(),
  });
}

export function requestCoffeeMachineQueueLength(
  callback: (response: ApiResponse<number>) => void
) {
  callback({
    status: "error",
    error: "Numeric value has exceeded Number.MAX_SAFE_INTEGER.",
  });
}

function logPerson(person: Person) {
  console.log(
    ` - ${person.name}, ${person.age}, ${
      person.type === "admin" ? person.role : person.occupation
    }`
  );
}

function startTheApp(callback: (error: Error | null) => void) {
  requestAdmins((adminsResponse) => {
    console.log("Admins:");
    if (adminsResponse.status === "success") {
      adminsResponse.data.forEach(logPerson);
    } else {
      return callback(new Error(adminsResponse.error));
    }

    console.log();

    requestUsers((usersResponse) => {
      console.log("Users:");
      if (usersResponse.status === "success") {
        usersResponse.data.forEach(logPerson);
      } else {
        return callback(new Error(usersResponse.error));
      }

      console.log();

      requestCurrentServerTime((serverTimeResponse) => {
        console.log("Server time:");
        if (serverTimeResponse.status === "success") {
          console.log(
            `   ${new Date(serverTimeResponse.data).toLocaleString()}`
          );
        } else {
          return callback(new Error(serverTimeResponse.error));
        }

        console.log();

        requestCoffeeMachineQueueLength((coffeeMachineQueueLengthResponse) => {
          console.log("Coffee machine queue length:");
          if (coffeeMachineQueueLengthResponse.status === "success") {
            console.log(`   ${coffeeMachineQueueLengthResponse.data}`);
          } else {
            return callback(new Error(coffeeMachineQueueLengthResponse.error));
          }

          callback(null);
        });
      });
    });
  });
}

startTheApp((e: Error | null) => {
  console.log();
  if (e) {
    console.log(
      `Error: "${e.message}", but it's fine, sometimes errors are inevitable.`
    );
  } else {
    console.log("Success!");
  }
});

// 10ë²ˆ

interface User {
  type: "user";
  name: string;
  age: number;
  occupation: string;
}

interface Admin {
  type: "admin";
  name: string;
  age: number;
  role: string;
}

type Person = User | Admin;

const admins: Admin[] = [
  { type: "admin", name: "Jane Doe", age: 32, role: "Administrator" },
  { type: "admin", name: "Bruce Willis", age: 64, role: "World saver" },
];

const users: User[] = [
  {
    type: "user",
    name: "Max Mustermann",
    age: 25,
    occupation: "Chimney sweep",
  },
  { type: "user", name: "Kate MÃ¼ller", age: 23, occupation: "Astronaut" },
];

export type ApiResponse<T> =
  | {
      status: "success";
      data: T;
    }
  | {
      status: "error";
      error: string;
    };

type CallbackBasedAsyncFunction<T> = (
  callback: (response: ApiResponse<T>) => void
) => void;
type PromiseBasedAsyncFunction<T> = () => Promise<T>;

export function promisify<T>(
  fn: CallbackBasedAsyncFunction<T>
): () => Promise<T> {
  return () =>
    new Promise<T>((resolve, reject) => {
      fn((response) => {
        if (response.status === "success") {
          resolve(response.data);
        } else {
          reject(new Error(response.error));
        }
      });
    });
}

const oldApi = {
  requestAdmins(callback: (response: ApiResponse<Admin[]>) => void) {
    callback({
      status: "success",
      data: admins,
    });
  },
  requestUsers(callback: (response: ApiResponse<User[]>) => void) {
    callback({
      status: "success",
      data: users,
    });
  },
  requestCurrentServerTime(callback: (response: ApiResponse<number>) => void) {
    callback({
      status: "success",
      data: Date.now(),
    });
  },
  requestCoffeeMachineQueueLength(
    callback: (response: ApiResponse<number>) => void
  ) {
    callback({
      status: "error",
      error: "Numeric value has exceeded Number.MAX_SAFE_INTEGER.",
    });
  },
};

export const api = {
  requestAdmins: promisify(oldApi.requestAdmins),
  requestUsers: promisify(oldApi.requestUsers),
  requestCurrentServerTime: promisify(oldApi.requestCurrentServerTime),
  requestCoffeeMachineQueueLength: promisify(
    oldApi.requestCoffeeMachineQueueLength
  ),
};

function logPerson(person: Person) {
  console.log(
    ` - ${person.name}, ${person.age}, ${
      person.type === "admin" ? person.role : person.occupation
    }`
  );
}

async function startTheApp() {
  console.log("Admins:");
  (await api.requestAdmins()).forEach(logPerson);
  console.log();

  console.log("Users:");
  (await api.requestUsers()).forEach(logPerson);
  console.log();

  console.log("Server time:");
  console.log(
    `   ${new Date(await api.requestCurrentServerTime()).toLocaleString()}`
  );
  console.log();

  console.log("Coffee machine queue length:");
  console.log(`   ${await api.requestCoffeeMachineQueueLength()}`);
}

startTheApp().then(
  () => {
    console.log("Success!");
  },
  (e: Error) => {
    console.log(
      `Error: "${e.message}", but it's fine, sometimes errors are inevitable.`
    );
  }
);

// In case you are stuck:
// https://www.typescriptlang.org/docs/handbook/2/generics.html
```
